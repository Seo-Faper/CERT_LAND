<!DOCTYPE html>
<html lang="kr" dir="ltr">
  <head>
    <script src="http://code.jquery.com/jquery-latest.min.js"></script>
   <meta charset="utf-8">
   <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
   <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
   <link href="https://fonts.googleapis.com/css?family=Nanum+Myeongjo:400,700,800&amp;subset=korean" rel="stylesheet">
   <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
    <meta charset="utf-8">
    <style media="screen">
      .infocon{
        float: right;
      }
      .container{
        margin-right: 15px;
      }
      #footer {

    position: absolute;

    left: 0;

    bottom: 0;

    width: 100%;


	text-align: center;
}
    .jumbotron{
      margin-bottom: 0px;
    }
    .dropdown:hover .dropdown-menu {
    display: block;
    margin-top: 0;
}
    </style>

    <title>CERT 업무체계</title>
  </head>
  <body>
    <!-- header -->
    <div class="jumbotron text-center">
       <h1>CERT 업무 체계</h1>
       <p id = "clock">YYYY년 MM월 DD일 HH시 mm분 ss초</p>
       <div class="infocon">
         <table border="1">
           <tr>
             <td colspan="2">사이버방호태세</td>
             <td rowspan="2">국가 사이버 위기 경보</td>
             <td rowspan="2">국가 인터넷 침해사고 경보</td>
           </tr>
           <tr>
             <td>훈련</td>
             <td>실제</td>
           </tr>
           <tr>
             <td>v</td>
             <td>IV</td>
             <td>관심</td>
             <td>관심</td>
           </tr>
         </table>
       </div>
       <ul class="nav navbar-nav">
           <li class="dropdown">
             <a href="#" class="dropdown-toggle" data-toggle="dropdown">사이버방호<b class="caret"></b></a>
             <ul class="dropdown-menu">
               <li><a href="#">3-1번 메뉴</a></li>
               <li class="divider"></li>
               <li class="dropdown-header">네비게이션 헤더</li>
               <li><a href="#">3-4번 메뉴</a></li>
             </ul>
           </li>
           <li class="dropdown">
             <a href="#" class="dropdown-toggle" data-toggle="dropdown">사이버 위협<b class="caret"></b></a>
             <ul class="dropdown-menu">
               <li><a href="#">3-1번 메뉴</a></li>
               <li class="divider"></li>
               <li class="dropdown-header">네비게이션 헤더</li>
               <li><a href="#">3-4번 메뉴</a></li>
             </ul>
           </li>
           <li class="dropdown">
             <a href="#" class="dropdown-toggle" data-toggle="dropdown">침해대응시스템<b class="caret"></b></a>
             <ul class="dropdown-menu">
               <li><a href="#">3-1번 메뉴</a></li>
               <li class="divider"></li>
               <li class="dropdown-header">네비게이션 헤더</li>
               <li><a href="#">3-4번 메뉴</a></li>
             </ul>
           </li>
           <li class="dropdown">
             <a href="#" class="dropdown-toggle" data-toggle="dropdown">정보보호장비 관리<b class="caret"></b></a>
             <ul class="dropdown-menu">
               <li><a href="#">3-1번 메뉴</a></li>
               <li class="divider"></li>
               <li class="dropdown-header">네비게이션 헤더</li>
               <li><a href="#">3-4번 메뉴</a></li>
             </ul>
           </li>
           <li class="dropdown">
             <a href="#" data-toggle="modal" data-target="#Info"> 인계 사항</a>
           </li>
         </ul>
         <div class="modal fade" id="Info" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
          <div class="modal-dialog" role="document">
          <div class="modal-content">
         <div class="modal-header">
          <h5 class="modal-title" id="ip">인계 사항 입력</h5>
        </div>
        <div class="ips">
          <textarea id = "txt" name="talk" rows="8" cols="80"></textarea>
          <button class="btn btn-default" type="button" name="완료" onclick="saveText()">완료</button>
        </div>
        </div>
       </div>
      </div>
         <br>
         <br>
    </div>


      <div class="container pt-3">
        <div class="row">
          <a href="" id="download">다운로드</a>
          <table border="1" id = "csvInfo">
              <tr>
                <td>일시</td>
                <td>구분</td>
                <td>　</td>
                <td>작업</td>
                <td>체계명</td>
                <td>내용</td>
                <td>작업자</td>
                <td>비고</td>
              </tr>
              <tbody id="dynamicTbody">

              </tbody>
          </table>
        </div>

    <div class="jumbotron text-center mt-5 mb-0" id = "footer">
       <h3 class="text-secondary">CERT 업무체계</h3>
        <p><span class="text-primary">일병 서종찬</span>
        </p>
    </div>
  </body>
  <script type="text/javascript">
    var clockTarget = document.getElementById("clock");
    var text = document.getElementById('txt');

    function clock() {
    var date = new Date();
    var year = date.getYear()-100;
    var month = date.getMonth();
    var clockDate = date.getDate();
    var day = date.getDay();
    var week = ['일', '월', '화', '수', '목', '금', '토'];
    var hours = date.getHours();
    var minutes = date.getMinutes();
    var seconds = date.getSeconds();
    clockTarget.innerText = `${month+1}월 ${clockDate}일 ${week[day]}요일` +
 `${hours < 10 ? `0${hours}` : hours}:${minutes < 10 ? `0${minutes }`  : minutes }:${seconds < 10 ? `0${seconds }`  : seconds }`;

}
function getTime(){
  var date = new Date();
  var year = date.getYear()-100;
  var month = date.getMonth();
  var clockDate = date.getDate();
  var day = date.getDay();
  var week = ['일', '월', '화', '수', '목', '금', '토'];
  var hours = date.getHours();
  var minutes = date.getMinutes();
  return `${year}.${month+1}.${clockDate}(${week[day]}) `+`${hours < 10 ? `0${hours}` : hours}:${minutes < 10 ? `0${minutes }`  : minutes }`;
}


function saveText(){
  var payload = {time : '', kind : '', policy : '',work : '',name : '',text : '',writer : '', more: '' }
  var message = text.value;
  payload.time = getTime();
  payload.kind = "인계 사항";
  payload.text = message;
  payload.writer = "중사 조현호";
  tableCreate(payload);
  text.value = '';
}

function tableCreate(data){

var tc = new Array();
var html = '';

tc.push(data);

for(key in tc){
html += '<tr>';
html += '<td>'+tc[key].time+'</td>';
html += '<td>'+tc[key].kind+'</td>';
html += '<td>'+tc[key].policy+'</td>';
html += '<td>'+tc[key].work+'</td>';
html += '<td>'+tc[key].name+'</td>';
html += '<td>'+tc[key].text+'</td>';
html += '<td>'+tc[key].writer+'</td>';
html += '<td>'+tc[key].more+'</td>';
html += '</tr>';
}
$("#dynamicTbody").append(html);

}

function init() {

clock();
setInterval(clock, 1000);
}
init();

document.addEventListener('DOMContentLoaded', function(){
  document.getElementById('download').addEventListener('click', function(){
    saveCSV('data.csv'); // CSV파일 다운로드 함수 호출
    return false;
  })
});

//CSV 생성 함수
function saveCSV(fileName){
    //CSV 문자열 생성
    let downLink = document.getElementById('download');
    let csv = ''; //CSV최종 문자열을 저장하는 변수
    let rows = document.querySelectorAll("#csvInfo tr"); // 테이블에서 행 요소들을 모두 선택

    //행단위 루핑
    for (var i = 0; i < rows.length; i++) {
        let cells = rows[i].querySelectorAll("td, th");
        let row = [];
        //행의 셀 값을 배열로 얻기
        cells.forEach(function(cell){
          row.push(cell.innerHTML);
        });

        csv += row.join(',') + (i != rows.length-1 ? '\n':''); // 배열을 문자열+줄바꿈으로 변환
    }

    //CSV 파일 저장
    csvFile = new Blob([csv], {type: "text/csv"}); // 생성한 CSV 문자열을 Blob 데이터로 생성
    downLink.href = window.URL.createObjectURL(csvFile); // Blob 데이터를 URL 객체로 감싸 다운로드 하이퍼링크에 붙임.
    downLink.download = fileName; // 인자로 받은 다운로드 파일명을 지정
}

</script>
</html>
